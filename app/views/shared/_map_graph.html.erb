<script type="text/javascript">
	var state = "";
  var model = '<%= model %>';
	var curID = "<%= id %>";

	function setState(st){
	  state = st;
	  sendToGraph(model + "/age/" + curID + "/" + state);
	}
	
	function sendToMap(dataString) {
    thisMovie("map").sendTextToFlash(dataString);
  }
  
  function sendToGraph(dataString) {
    thisMovie("bar-graph").sendTextToFlash(dataString);
    //alert("sending to graph " + dataString);
  }
	
	$(document).ready(function(){
	  function getFlashMovie(movieName) { 
      var isIE = navigator.appName.indexOf("Microsoft") != -1;
      return (isIE) ? window[movieName] : document[movieName];
    }
	  
	  //alert("ready!");
	  $("a.dataset").click(function(){
	    $(".vote-table .selected").removeClass("selected");  //remove the selected items
	    $(this).parent().parent().addClass("selected");  //add selected to the clicked item
	    
	    //var text = $(this).text();
      var title = $(this).children('.jq-title').val();
      var wikipedia_url = $(this).children('.jq-wikipedia').val();
      var website_url = $(this).children('.jq-website').val();

      if(wikipedia_url == null) {
        $("div.wikipedia").hide();
      }
      else{
        $("div.wikipedia").show();
        $("div.wikipedia a").attr("href", wikipedia_url );
      }

      if(website_url == null) {
        $("div.website").hide();
      }
      else{
        $("div.website").show();
        $("div.website a").attr("href", website_url );
      }

	    //fade the text
	    $("h4.map-title").fadeOut(500, function(){
	      $(this).text(title);
	      $(this).fadeIn(500);
	    });


      map_data = $(this).children('.jq-map-data').val();
	    
      curID = map_data.split('_')[0]
      model = map_data.split('_')[1]
	    
	    sendToMap(model + "/map/" + curID + "/");  //send to the map
	    sendToGraph(model + "/age/" + curID + "/" + state);  //send to the graph
	    
	    return false;
	  });
	});

  function thisMovie(movieName) {
    if (navigator.appName.indexOf("Microsoft") != -1) {
      return window[movieName];
    } else {
      return document[movieName];
    }
  }
	
	var mapvars = {
	  xmlpath: model + "/map/" + curID + "/",
	  baseURL:"/services/website/"
	};
	
	var agevars = {
	  xmlpath: model + "/age/" + curID + "/",
	  baseURL:"/services/website/",
	  barwidth: 25
	};
	
  var params = {
      menu: "false",
      wmode: "transparent"
  };
  var attributes = {
    allowfullscreen: "true",
    allowscriptaccess: "always",
    wmode: "transparent"
  };

  swfobject.embedSWF("/swf/map.swf", "map", "350", "270","10.0.0", params, mapvars, attributes);
  swfobject.embedSWF("/swf/bar-graph.swf", "bar-graph", "350", "200","10.0.0", params, agevars, attributes);

</script>

<div class="maps-container">
  <div class="corp-title"><h4 class="map-title"><%= title %></h4>
    <div class="wikipedia">
      <%= wikipedia.blank? ? "" : "<a href='#{wikipedia}'><img src=\"/images/wikipedia.png\" alt=\"wikipedia\" /></a>".html_safe %>
    </div>
    <div class="website">
      <%= website.blank? ? "" : "<a href='#{website}'><img src=\"/images/website.png\" alt=\"wikipedia\" /></a>".html_safe %>
    </div>
  </div>
  <div id="map"></div>
  <h4>Whoâ€™s Being Counted?</h4>
  <div id="bar-graph"></div>
</div>
