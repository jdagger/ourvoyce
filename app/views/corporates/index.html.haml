- content_for :scripts do
  = javascript_include_tag "change_support.js"

.left-content
  %fieldset
    %legend Filtering:
    =link_to 'Thumbs Up', :filter => 'vote=thumbsup', :sort => params[:sort], :page => 1
    |
    =link_to 'Thumbs Down', :filter => 'vote=thumbsdown', :sort => params[:sort], :page => 1
    |
    =link_to 'Neutral', :filter => 'vote=neutral', :sort => params[:sort], :page => 1
    |
    =link_to 'Voted', :filter => 'vote=vote', :sort => params[:sort], :page => 1
    |
    =link_to 'No Vote', :filter => 'vote=novote', :sort => params[:sort], :page => 1
    ||
    =link_to 'All Records', :filter => 'vote=all', :sort => params[:sort], :page => 1

  = render :partial => "shared/paging", :object => @presenter.paging, :as => :paging_data
  %div.vote-table-wrap
    %table.vote-table
      %thead
        %tr
          %th= table_sort_header_link :header => "Vote", :sort_column => 'votedate', :link_params => { :filter => params[:filter], :page => params[:page] }
          %th= table_sort_header_link :header => "Name", :sort_column => 'name', :link_params => {:filter => params[:filter], :page => params[:page] }
          %th= table_sort_header_link :header => "Profit", :sort_column => 'profit', :link_params => {:filter => params[:filter], :page => params[:page] }
          %th= table_sort_header_link :header => "Revenue", :sort_column => 'revenue', :link_params => {:filter => params[:filter], :page => params[:page] }
          %th
            = table_sort_header_link :header => "SS", :sort_column => 'social', :link_params => {:filter => params[:filter], :page => params[:page] }
            = '/'
            = table_sort_header_link :header => "PR", :sort_column => 'participation', :link_params => {:filter => params[:filter], :page => params[:page] }
          %th -
      %tbody
        - count = 0
        - @presenter.corporations.each do |c|
          - count = count + 1
          %tr{:class => "#{count%2 == 1 ? 'even' : 'odd'}", :valign => "middle"}
            %td
              = render :partial => "shared/vote_control", :object =>{:id => c.id, :support_type => c.support_type, :post_url => :corporate_vote}, :as => :d
              = c.updated_at
            %td
              %a{:class => 'jq-corporation dataset', :href=> "#{c.id}_corporate"}
                %input{:type => :hidden, :class => 'jq-corporation-id', :value =>  c.id}
                %img{:src => get_corporate_image_128(c.logo), :alt => c.name}
                %br
                = c.name
            %td= "$#{number_to_human(c.revenue, :precision => 1, :significant => false)}"
            %td= "$#{number_to_human(c.profit, :precision => 1, :significant => false)}"
            %td
              = c.social_score
              %img{:src => participation_rate_image(c.participation_rate), :alt => c.participation_rate}
  = render :partial => "shared/paging", :object => @presenter.paging, :as => :paging_data
.graph-contents
  %div.map-search
    Search:
    = form_tag :corporates_index do
      =text_field_tag :search_filter, @presenter.search_text
      =submit_tag 'Search'
  = render :partial => "shared/map_graph", :locals => {:id => @presenter.corporations.first.id, :model => "corporate"}
